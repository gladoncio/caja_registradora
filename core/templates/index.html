{% extends 'base/nav.html' %}

{% block body %}
{% load static %}
    <!-- Begin Page Content -->
    <div class="container-fluid">

        <!-- Page Heading -->
        <div class="d-sm-flex align-items-center justify-content-between mb-4">
            <h1 class="h3 mb-0 text-gray-800">Dashboard</h1>
        </div>
        <!-- Agregar la lista desplegable para cambiar el tamaño del texto -->


        <!-- Content Row -->
        <div class="row">
            <!-- Search Box for Price -->
            <div class="col-lg-12">
                <div class="card shadow mb-4">
                    <div class="card-header py-3">
                        <h6 class="m-0 font-weight-bold text-primary">Buscar Precio</h6>
                    </div>
                    <div class="card-body">
                        <form>
                            <div class="form-group">
                                <input type="text" class="form-control form-control-lg" id="productSearchInput" placeholder="Ingrese el nombre del producto">
                            </div>
                            <button type="button" class="btn btn-primary" id="searchButton">Buscar</button>
                        </form>
                        <div class="mt-4" id="searchResults">
                                    <div class="mt-4" id="searchResults">
                                        <table class="table">
                                            <thead>
                                                <tr>
                                                    <th>Nombre</th>
                                                    <th>Precio</th>
                                                    <th>Código de Barras</th>
                                                    <th>Gramaje</th>
                                                    <th>Foto</th> <!-- Agregamos la columna para la foto -->
                                                </tr>
                                            </thead>
                                            <tbody id="searchResultsBody">
                                                <!-- Espacio para mostrar los resultados de búsqueda (precios) -->
                                            </tbody>
                                        </table>
                                    </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- /.container-fluid -->
</div>


<!-- End of Main Content -->

<!-- Footer -->
{% include 'base/footer.html' %}
<!-- End of Footer -->

</div>
<!-- End of Content Wrapper -->
{% include 'base/logout.html' %}
</div>
<!-- End of Page Wrapper -->

<!-- Scroll to Top Button-->
<a class="scroll-to-top rounded" href="#page-top">
    <i class="fas fa-angle-up"></i>
</a>

<script>

    
    const searchButton = document.getElementById('searchButton');
    const productSearchInput = document.getElementById('productSearchInput');
    const searchResults = document.getElementById('searchResults');

    // Trigger search on button click
    searchButton.addEventListener('click', performSearch);

    // Trigger search on "Enter" key press
    productSearchInput.addEventListener('keydown', function (event) {
        if (event.key === 'Enter') {
            event.preventDefault(); // Prevent form submission
            performSearch();
        }
    });

    function performSearch() {
    const productName = productSearchInput.value;

    // Evitar realizar la búsqueda si el campo está en blanco
    if (productName.trim() === '') {
        return;
    }

    fetch(`/api/busqueda/?search=${productName}`)
        .then(response => response.json())
        .then(data => {
            const resultsBody = document.getElementById('searchResultsBody');
            resultsBody.innerHTML = '';  // Limpiar la tabla antes de agregar nuevos resultados

            if (data.length > 0) {
                data.forEach(product => {
                    const row = resultsBody.insertRow();
                    const nombreCell = row.insertCell();
                    const precioCell = row.insertCell();
                    const codigoBarrasCell = row.insertCell();
                    const gramajeCell = row.insertCell();
                    const fotoCell = row.insertCell();  // Agregamos la celda para la foto

                nombreCell.innerHTML = `<span>${product.nombre}</span>`;
                precioCell.innerHTML = `<span>$${Math.floor(product.precio)}</span>`;
                codigoBarrasCell.innerHTML = `<span>${product.codigo_barras}</span>`;
                gramajeCell.innerHTML = `<span>${product.gramaje ? product.gramaje + (product.tipo_gramaje === 'kg' ? ' kg' : ' gr') : ''}</span>`; // Display gramaje and unit
                fotoCell.innerHTML = `<img src="${product.foto}" alt="${product.nombre}" style="max-width: 100px;">`;

            // Agrega la clase de tamaño de texto al contenedor span
            nombreCell.querySelector('span').classList.add('resize-text');
            precioCell.querySelector('span').classList.add('resize-text');
            codigoBarrasCell.querySelector('span').classList.add('resize-text');
                });
            } else {
                resultsBody.innerHTML = `<tr><td colspan="4">Producto no encontrado.</td></tr>`;
            }

            // Clear the search input field after search
            productSearchInput.value = '';
        })
        .catch(error => {
            console.error('Error al obtener los resultados:', error);
            resultsBody.innerHTML = `<tr><td colspan="4">Error al obtener los resultados.</td></tr>`;
        });
}



</script>
<script>
// Obtener el elemento select y los elementos de celda que deseas cambiar de tamaño
const textSizeSelect = document.getElementById('textSizeSelect');
const cellsToResize = document.querySelectorAll('.resize-text');

// Agregar un evento de cambio al elemento select
textSizeSelect.addEventListener('change', function () {
    const selectedSize = textSizeSelect.value;

    // Aplicar el tamaño de texto seleccionado a las celdas
    cellsToResize.forEach(cell => {
        cell.classList.remove('small-text', 'medium-text', 'large-text');
        cell.classList.add(`${selectedSize}-text`);
    });
});
</script>


{% endblock %}
